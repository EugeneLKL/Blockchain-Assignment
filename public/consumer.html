<!--This is the Home page for Project Dayak-->
<!DOCTYPE html>
<html lang="en">

<head>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@1.2.11/dist/web3.min.js"></script>
  <script src="js/allFunction.js"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content=" width=device-width, initial-scale=1.0" />
  <title>Durian Tracker Application</title>
  <!--Links this page to other stylesheets and "ico" file-->
  <link rel="icon" href="/images/durian-removebg-preview.ico" />
  <link rel="stylesheet" href="/css/animated_header.css" />
  <link rel="stylesheet" href="/css/navigation.css" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<!--A Background Image for Body-->

<body style="background-image: url(images/BGIMG.jpg)">
  <header>
    <div class="shell">
      <!--Title-->
      <div class="navi">
        <div class="logo">
          <img src="images/durian_Main.png" alt="Durian Logo" height="100" />
        </div>
        <div class="title">
          <h1>Durian Tracker Application</h1>
        </div>
        <!--Header text-->
        <div class="titletext">
          <h1>
            Tracing Durian through
            <span style="color: turquoise">Blockchain</span>
          </h1>
          <h2>Secure and transparent tracking of data and transactions</h2>
        </div>
      </div>
    </div>
  </header>
  <main>
    <div class="container">
      <div class="index_box">
        <br />

        <h1>Consumer</h1>
        <div class="container">
          <div style="margin-top: 15px" class="mini_box">
            <h2><u>Update Durian for Consumer</u></h2>
            <br />
            <table>
              <tr>
                <td>Durian ID:</td>
                <td class="tableInput">
                  <select id="updateDurianAddress" class="inputBox"></select>
                </td>
              </tr>
              <tr>
                <td>Date Received From Retailer:</td>
                <td class="tableInput">
                  <input type="date" id="dateReceivedFromRetailer" placeholder="Enter Date Received From Retailer"
                    class="inputBox" />
                </td>
              </tr>
            </table>
            <br />
            <button onclick="updateDurianInfoForConsumer(); snackbar();" class="button">
              Update Durian
            </button>
          </div>
          <div style="margin-top: 15px; margin-bottom: 15px" class="mini_box">
            <h2><u>Rate Durian</u></h2>
            <br />

            <table>
              <tr>
                <td>Durian ID:</td>
                <td class="tableInput">
                  <select id="RateDurianAddress" class="inputBox"></select>
                </td>
              </tr>
            </table>

            <br />
            <div>
              Rating Scale &nbsp; 1 - Inedible &nbsp; 2 - Bad &nbsp; 3 -
              Average &nbsp; 4 - Good &nbsp; 5 - Excellent
            </div>
            <br />
            <label for="ratingTaste">Rate Taste:</label>
            <div class="ratingTaste">
              <input type="radio" id="ratingTaste1" name="ratingTaste" value="0" />
              <label for="ratingTaste1">1</label>

              <input type="radio" id="ratingTaste2" name="ratingTaste" value="1" />
              <label for="ratingTaste2">2</label>

              <input type="radio" id="ratingTaste3" name="ratingTaste" value="2" />
              <label for="ratingTaste3">3</label>

              <input type="radio" id="ratingTaste4" name="ratingTaste" value="3" />
              <label for="ratingTaste4">4</label>

              <input type="radio" id="ratingTaste5" name="ratingTaste" value="4" />
              <label for="ratingTaste5">5</label>
            </div>
            <br />
            <label for="ratingFragrance">Rate Fragrance:</label>
            <div class="ratingFragrance">
              <input type="radio" id="ratingFragrance1" name="ratingFragrance" value="0" />
              <label for="ratingFragrance1">1</label>

              <input type="radio" id="ratingFragrance2" name="ratingFragrance" value="1" />
              <label for="ratingFragrance2">2</label>

              <input type="radio" id="ratingFragrance3" name="ratingFragrance" value="2" />
              <label for="ratingFragrance3">3</label>

              <input type="radio" id="ratingFragrance4" name="ratingFragrance" value="3" />
              <label for="ratingFragrance4">4</label>

              <input type="radio" id="ratingFragrance5" name="ratingFragrance" value="4" />
              <label for="ratingFragrance5">5</label>
            </div>
            <br />
            <label for="ratingTexture">Rate Texture:</label>
            <div class="ratingTexture">
              <input type="radio" id="ratingTexture1" name="ratingTexture" value="0" />
              <label for="ratingTexture1">1</label>

              <input type="radio" id="ratingTexture2" name="ratingTexture" value="1" />
              <label for="ratingTexture2">2</label>

              <input type="radio" id="ratingTexture3" name="ratingTexture" value="2" />
              <label for="ratingTexture3">3</label>

              <input type="radio" id="ratingTexture4" name="ratingTexture" value="3" />
              <label for="ratingTexture4">4</label>

              <input type="radio" id="ratingTexture5" name="ratingTexture" value="4" />
              <label for="ratingTexture5">5</label>
            </div>
            <br />
            <label for="ratingCreaminess">Rate Creaminess:</label>
            <div class="ratingCreaminess">
              <input type="radio" id="ratingCreaminess1" name="ratingCreaminess" value="0" />
              <label for="ratingCreaminess1">1</label>

              <input type="radio" id="ratingCreaminess2" name="ratingCreaminess" value="1" />
              <label for="ratingCreaminess2">2</label>

              <input type="radio" id="ratingCreaminess3" name="ratingCreaminess" value="2" />
              <label for="ratingCreaminess3">3</label>

              <input type="radio" id="ratingCreaminess4" name="ratingCreaminess" value="3" />
              <label for="ratingCreaminess4">4</label>

              <input type="radio" id="ratingCreaminess5" name="ratingCreaminess" value="4" />
              <label for="ratingCreaminess5">5</label>
            </div>
            <br />
            <label for="ratingRipeness">Rate Ripeness:</label>
            <div class="ratingRipeness">
              <input type="radio" id="ratingRipeness1" name="ratingRipeness" value="0" />
              <label for="ratingRipeness1">1</label>

              <input type="radio" id="ratingRipeness2" name="ratingRipeness" value="1" />
              <label for="ratingRipeness2">2</label>

              <input type="radio" id="ratingRipeness3" name="ratingRipeness" value="2" />
              <label for="ratingRipeness3">3</label>

              <input type="radio" id="ratingRipeness4" name="ratingRipeness" value="3" />
              <label for="ratingRipeness4">4</label>

              <input type="radio" id="ratingRipeness5" name="ratingRipeness" value="4" />
              <label for="ratingRipeness5">5</label>
            </div>
            <br />

            <table style="margin-bottom: 10px">
              <tr>
                <td>Durian Grade:</td>
                <td class="tableInput">
                  <input type="text" id="gradeRating" placeholder="Enter Durian Grade Rating" size="44"
                    class="inputBox" />
                </td>
              </tr>
            </table>
            <table>
              <tr>
                <td>Comment:</td>
              </tr>
              <tr>
                <td>
                  <textarea style="resize: none; padding: 5px" id="comment" cols="80" rows="10"
                    placeholder="Provide a comment if any"></textarea>
                </td>
              </tr>
            </table>

            <br />
            <button onclick="updateDurianRating(); snackbar();" class="button">
              Rate Durian
            </button>
          </div>
        </div>
        <div class="mini_box">
          <table>
            <tr>
              <td>Durian ID:</td>
              <td>
                <select id="durianID" class="inputBox"></select>
              </td>
            </tr>
          </table>
          <br />
          <button onclick="durianInfoHandler()" class="button">
            Get Durian Info
          </button>
          <div style="margin-top: 15px">
            <table class="infoTable">
              <tr>
                <td>Durian ID:</td>
                <td>
                  <span id="tableDurianID"></span>
                </td>
              </tr>
              <tr>
                <td>Durian type:</td>
                <td>
                  <div><span id="durianType"></span></div>
                </td>
              </tr>
              <tr>
                <td>Farm ID:</td>
                <td>
                  <div><span id="farmID"></span></div>
                </td>
              </tr>
              <tr>
                <td>Tree ID:</td>
                <td>
                  <div><span id="treeID"></span></div>
                </td>
              </tr>
              <tr>
                <td>Harvest date and time:</td>
                <td>
                  <div><span id="harvestDateTime"></span></div>
                </td>
              </tr>
              <tr>
                <td>Date pass to distribution center:</td>
                <td>
                  <div><span id="datePassToDistributionCenter"></span></div>
                </td>
              </tr>
              <tr>
                <td>Distribution center ID:</td>
                <td>
                  <div><span id="distributionCenterID"></span></div>
                </td>
              </tr>
              <tr>
                <td>Date received from farm:</td>
                <td>
                  <div><span id="dateReceivedFromFarm"></span></div>
                </td>
              </tr>
              <tr>
                <td>Date pass to retailer:</td>
                <td>
                  <div><span id="datePassToRetailer"></span></div>
                </td>
              </tr>
              <tr>
                <td>Retailer address:</td>
                <td>
                  <div><span id="retailerAddress"></span></div>
                </td>
              </tr>
              <tr>
                <td>Date received from distribution center:</td>
                <td>
                  <div>
                    <span id="dateReceivedFromDistributionCenter"></span>
                  </div>
                </td>
              </tr>
              <tr>
                <td>Date pass to consumer:</td>
                <td>
                  <div><span id="datePassToConsumer"></span></div>
                </td>
              </tr>
              <tr>
                <td>Consumer address:</td>
                <td>
                  <div><span id="consumerAddress"></span></div>
                </td>
              </tr>
              <tr>
                <td>Date received from retailer:</td>
                <td>
                  <div><span id="tableDateReceivedFromRetailer"></span></div>
                </td>
              </tr>
              <tr>
                <td>Taste:</td>
                <td>
                  <div><span id="taste"></span></div>
                </td>
              </tr>
              <tr>
                <td>Fragrance:</td>
                <td>
                  <div><span id="fragrance"></span></div>
                </td>
              </tr>
              <tr>
                <td>Texture:</td>
                <td>
                  <div><span id="texture"></span></div>
                </td>
              </tr>
              <tr>
                <td>Creaminess:</td>
                <td>
                  <div><span id="creaminess"></span></div>
                </td>
              </tr>
              <tr>
                <td>Ripeness:</td>
                <td>
                  <div><span id="ripeness"></span></div>
                </td>
              </tr>
              <tr>
                <td>Grade:</td>
                <td>
                  <div><span id="grade"></span></div>
                </td>
              </tr>
              <tr>
                <td>Comment:</td>
                <td>
                  <div><span id="tableComment"></span></div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <button class="disconnectButton" onclick="disconnect()">
          Log Out
        </button>
      </div>
      <div id="snackbar">Changes made successfully</div>
    </div>
  </main>
</body>

<script>
  window.addEventListener('load', async () => {
    await accessToMetamask();
    await accessToContract();

    const currentUser = window.ethereum.selectedAddress;

    // Get all durian
    const allDurians = await getDurian();

    // For each durian
    allDurians.forEach((durian) => {
      if (
        durian.durianRetailer.consumerAddress.toLowerCase() ==
        currentUser.toLowerCase()
      ) {
        const option = document.createElement('option');
        option.value = durian.durianID;
        option.innerHTML = durian.durianID;
        document.getElementById('durianID').appendChild(option);
        document
          .getElementById('RateDurianAddress')
          .appendChild(option.cloneNode(true));
        document
          .getElementById('updateDurianAddress')
          .appendChild(option.cloneNode(true));
      }
    });
  });

  async function durianInfoHandler() {
    const durian = await getDurianInfoForConsumer();
    console.log(durian);

    // durian.durianID
    const durianID = durian.durianID;
    console.log(durianID);
    if (durian.durianID == 0) {
      document.getElementById('tableDurianID').innerHTML = '-';
    } else {
      document.getElementById('tableDurianID').innerHTML = durian.durianID;
    }

    // durian.durianType
    const durianType = durian.durianType;
    if (durian.durianType == '') {
      document.getElementById('durianType').innerHTML = '-';
    } else {
      document.getElementById('durianType').innerHTML = durian.durianType;
    }

    // durian.durianFarm.farmID
    const farmID = durian.durianFarm.farmID;
    if (durian.durianFarm.farmID == 0) {
      document.getElementById('farmID').innerHTML = '-';
    } else {
      document.getElementById('farmID').innerHTML = durian.durianFarm.farmID;
    }

    // durian.durianFarm.treeID
    const treeID = durian.durianFarm.treeID;
    if (durian.durianFarm.treeID == 0) {
      document.getElementById('treeID').innerHTML = '-';
    } else {
      document.getElementById('treeID').innerHTML = durian.durianFarm.treeID;
    }

    // durian.durianFarm.harvestDateTime
    const harvestDateTime = durian.durianFarm.harvestDateTime;

    // Change to html date time format
    const harvestDate = new Date(harvestDateTime * 1000);
    const htmlHarvestDateTime = harvestDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ');

    if (durian.durianFarm.harvestDateTime == 0) {
      document.getElementById('harvestDateTime').innerHTML = '-';
    } else {
      document.getElementById('harvestDateTime').innerHTML =
        htmlHarvestDateTime;
    }

    // durian.durianFarm.datePassToDistributionCenter
    const datePassToDistributionCenter =
      durian.durianFarm.datePassToDistributionCenter;

    // Change to html date time format
    const passToDistributionCenterDate = new Date(
      datePassToDistributionCenter * 1000,
    );
    const htmlPassToDistributionCenterDate = passToDistributionCenterDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ')
      .slice(0, 10);

    if (durian.durianFarm.datePassToDistributionCenter == 0) {
      document.getElementById('datePassToDistributionCenter').innerHTML = '-';
    } else {
      document.getElementById('datePassToDistributionCenter').innerHTML =
        htmlPassToDistributionCenterDate;
    }

    // durian.durianFarm.distributionCenterID
    const distributionCenterID = durian.durianFarm.distributionCenterID;
    if (durian.durianFarm.distributionCenterID == 0) {
      document.getElementById('distributionCenterID').innerHTML = '-';
    } else {
      document.getElementById('distributionCenterID').innerHTML =
        durian.durianFarm.distributionCenterID;
    }

    // durian.durianDistributionCenter.dateReceivedFromFarm
    const dateReceivedFromFarm =
      durian.durianDistributionCenter.dateReceivedFromFarm;

    // Change to html date time format
    const receivedFromFarmDate = new Date(dateReceivedFromFarm * 1000);
    const htmlReceivedFromFarmDate = receivedFromFarmDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ')
      .slice(0, 10);

    if (durian.durianDistributionCenter.dateReceivedFromFarm == 0) {
      document.getElementById('dateReceivedFromFarm').innerHTML = '-';
    } else {
      document.getElementById('dateReceivedFromFarm').innerHTML =
        htmlReceivedFromFarmDate;
    }

    // durian.durianDistributionCenter.datePassToRetailer
    const datePassToRetailer =
      durian.durianDistributionCenter.datePassToRetailer;

    // Change to html date time format
    const passToRetailerDate = new Date(datePassToRetailer * 1000);
    const htmlPassToRetailerDate = passToRetailerDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ')
      .slice(0, 10);

    if (durian.durianDistributionCenter.datePassToRetailer == 0) {
      document.getElementById('datePassToRetailer').innerHTML = '-';
    } else {
      document.getElementById('datePassToRetailer').innerHTML =
        htmlPassToRetailerDate;
    }

    // durian.durianDistributionCenter.retailerAddress
    const retailerAddress = durian.durianDistributionCenter.retailerAddress;
    if (
      durian.durianDistributionCenter.retailerAddress ==
      0x0000000000000000000000000000000000000000
    ) {
      document.getElementById('retailerAddress').innerHTML = '-';
    } else {
      document.getElementById('retailerAddress').innerHTML =
        durian.durianDistributionCenter.retailerAddress;
    }

    // durian.durianRetailer.dateReceivedFromDistributionCenter
    const dateReceivedFromDistributionCenter =
      durian.durianRetailer.dateReceivedFromDistributionCenter;

    // Change to html date time format
    const receivedFromDistributionCenterDate = new Date(
      dateReceivedFromDistributionCenter * 1000,
    );
    const htmlReceivedFromDistributionCenterDate =
      receivedFromDistributionCenterDate
        .toISOString()
        .slice(0, 16)
        .replace('T', ' ')
        .slice(0, 10);

    if (durian.durianRetailer.dateReceivedFromDistributionCenter == 0) {
      document.getElementById(
        'dateReceivedFromDistributionCenter',
      ).innerHTML = '-';
    } else {
      document.getElementById(
        'dateReceivedFromDistributionCenter',
      ).innerHTML = htmlReceivedFromDistributionCenterDate;
    }

    // durian.durianRetailer.datePassToConsumer
    const datePassToConsumer = durian.durianRetailer.datePassToConsumer;

    // Change to html date time format
    const passToConsumerDate = new Date(datePassToConsumer * 1000);
    const htmlPassToConsumerDate = passToConsumerDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ')
      .slice(0, 10);

    if (durian.durianRetailer.datePassToConsumer == 0) {
      document.getElementById('datePassToConsumer').innerHTML = '-';
    } else {
      document.getElementById('datePassToConsumer').innerHTML =
        htmlPassToConsumerDate;
    }

    // durian.durianRetailer.consumerAddress
    const consumerAddress = durian.durianRetailer.consumerAddress;
    if (
      durian.durianRetailer.consumerAddress ==
      0x0000000000000000000000000000000000000000
    ) {
      document.getElementById('consumerAddress').innerHTML = '-';
    } else {
      document.getElementById('consumerAddress').innerHTML =
        durian.durianRetailer.consumerAddress;
    }

    // durian.durianConsumer.dateReceivedFromRetailer
    const dateReceivedFromRetailer =
      durian.durianConsumer.dateReceivedFromRetailer;

    // Change to html date time format
    const receivedFromRetailerDate = new Date(
      dateReceivedFromRetailer * 1000,
    );
    const htmlReceivedFromRetailerDate = receivedFromRetailerDate
      .toISOString()
      .slice(0, 16)
      .replace('T', ' ')
      .slice(0, 10);

    if (durian.durianConsumer.dateReceivedFromRetailer == 0) {
      document.getElementById('tableDateReceivedFromRetailer').innerHTML =
        '-';
    } else {
      document.getElementById('tableDateReceivedFromRetailer').innerHTML =
        htmlReceivedFromRetailerDate;
    }

    // durian.durianConsumer.rating.taste
    const taste = durian.durianConsumer.rating.taste;
    if (durian.durianConsumer.rating.taste == 'Undefined') {
      document.getElementById('taste').innerHTML = '-';
    } else if (durian.durianConsumer.rating.taste == 0) {
      document.getElementById('taste').innerHTML = 'Inedible';
    } else if (durian.durianConsumer.rating.taste == 1) {
      document.getElementById('taste').innerHTML = 'Bad';
    } else if (durian.durianConsumer.rating.taste == 2) {
      document.getElementById('taste').innerHTML = 'Average';
    } else if (durian.durianConsumer.rating.taste == 3) {
      document.getElementById('taste').innerHTML = 'Good';
    } else if (durian.durianConsumer.rating.taste == 4) {
      document.getElementById('taste').innerHTML = 'Excellent';
    }

    // durian.durianConsumer.rating.fragrance
    const fragrance = durian.durianConsumer.rating.fragrance;
    if (durian.durianConsumer.rating.fragrance == 'Undefined') {
      document.getElementById('fragrance').innerHTML = '-';
    } else if (durian.durianConsumer.rating.fragrance == 0) {
      document.getElementById('fragrance').innerHTML = 'Inedible';
    } else if (durian.durianConsumer.rating.fragrance == 1) {
      document.getElementById('fragrance').innerHTML = 'Bad';
    } else if (durian.durianConsumer.rating.fragrance == 2) {
      document.getElementById('fragrance').innerHTML = 'Average';
    } else if (durian.durianConsumer.rating.fragrance == 3) {
      document.getElementById('fragrance').innerHTML = 'Good';
    } else if (durian.durianConsumer.rating.fragrance == 4) {
      document.getElementById('fragrance').innerHTML = 'Excellent';
    }

    // durian.durianConsumer.rating.texture
    const texture = durian.durianConsumer.rating.texture;
    if (durian.durianConsumer.rating.texture == 'Undefined') {
      document.getElementById('texture').innerHTML = '-';
    } else if (durian.durianConsumer.rating.texture == 0) {
      document.getElementById('texture').innerHTML = 'Inedible';
    } else if (durian.durianConsumer.rating.texture == 1) {
      document.getElementById('texture').innerHTML = 'Bad';
    } else if (durian.durianConsumer.rating.texture == 2) {
      document.getElementById('texture').innerHTML = 'Average';
    } else if (durian.durianConsumer.rating.texture == 3) {
      document.getElementById('texture').innerHTML = 'Good';
    } else if (durian.durianConsumer.rating.texture == 4) {
      document.getElementById('texture').innerHTML = 'Excellent';
    }

    // durian.durianConsumer.rating.creaminess
    const creaminess = durian.durianConsumer.rating.creaminess;
    if (durian.durianConsumer.rating.creaminess == 'Undefined') {
      document.getElementById('creaminess').innerHTML = '-';
    } else if (durian.durianConsumer.rating.creaminess == 0) {
      document.getElementById('creaminess').innerHTML = 'Inedible';
    } else if (durian.durianConsumer.rating.creaminess == 1) {
      document.getElementById('creaminess').innerHTML = 'Bad';
    } else if (durian.durianConsumer.rating.creaminess == 2) {
      document.getElementById('creaminess').innerHTML = 'Average';
    } else if (durian.durianConsumer.rating.creaminess == 3) {
      document.getElementById('creaminess').innerHTML = 'Good';
    } else if (durian.durianConsumer.rating.creaminess == 4) {
      document.getElementById('creaminess').innerHTML = 'Excellent';
    }

    // durian.durianConsumer.rating.ripeness
    const ripeness = durian.durianConsumer.rating.ripeness;
    if (durian.durianConsumer.rating.ripeness == 'Undefined') {
      document.getElementById('ripeness').innerHTML = '-';
    } else if (durian.durianConsumer.rating.ripeness == 0) {
      document.getElementById('ripeness').innerHTML = 'Inedible';
    } else if (durian.durianConsumer.rating.ripeness == 1) {
      document.getElementById('ripeness').innerHTML = 'Bad';
    } else if (durian.durianConsumer.rating.ripeness == 2) {
      document.getElementById('ripeness').innerHTML = 'Average';
    } else if (durian.durianConsumer.rating.ripeness == 3) {
      document.getElementById('ripeness').innerHTML = 'Good';
    } else if (durian.durianConsumer.rating.ripeness == 4) {
      document.getElementById('ripeness').innerHTML = 'Excellent';
    }

    // durian.durianConsumer.rating.grade
    const grade = durian.durianConsumer.rating.grade;
    if (durian.durianConsumer.rating.grade == undefined) {
      document.getElementById('grade').innerHTML = '-';
    } else {
      document.getElementById('grade').innerHTML = grade;
    }

    // durian.durianConsumer.rating.comment
    const comment = durian.durianConsumer.rating.comment;
    if (comment == '') {
      document.getElementById('tableComment').innerHTML = '-';
    } else {
      document.getElementById('tableComment').innerHTML = comment;
    }
  }
</script>
<script>
  // Call the setDefaultDate function when the DOM content is loaded
  document.addEventListener('DOMContentLoaded', function () {
    setDefaultDate();
  });
</script>
<script>
  // Call the setDefaultDate function when the DOM content is loaded
  document.addEventListener('DOMContentLoaded', function () {
    setDefaultTime();
  });
</script>
<script>
  // For each durian ID, add an option to the select box
  function addDurianIDOption(durianID) {
    var select = document.getElementById('selectDurianID');
    var option = document.createElement('option');
    option.text = durianID;
    select.add(option);
  }
</script>

</html>